import{p as H,v as V,T as ae,a as U,g as L,i as q,b as z,c as Q,d as K,s as ne,e as A,r as re,F as $,f as ie,h as W,N as j,j as se,G as oe,k as le,R,l as J,m as F,u as X,n as ce,o as me,_ as de,q as ue,t as fe,w as pe,x as ye,M as Z,y as he,z as ge}from"./vendor.49c286d8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=r(a);fetch(a.href,n)}})();const be=async({schema:e,optimizedDocumentNode:t})=>{const r=[],n=V(t,{OperationDefinition:i=>i.name?i:{...i,name:{kind:"Name",value:"QueryOperation"}}}),l=new ae(e),y=i=>{var f;return{...i,selectionSet:{...i.selectionSet||{kind:"SelectionSet",selections:[]},selections:[...((f=i.selectionSet)==null?void 0:f.selections)||[],...ve]}}},m=(i,f)=>{let d=f;const _=[];return i.forEach(v=>{d=d[v],Array.isArray(d)||d.kind==="Field"&&_.push(d.name.value)}),_},o=(i,f,d,_,v)=>{const p=m(_,v[0]),u=w=>{var k,I;const S=[];return V(w,U(l,{Field:{enter:E=>{var N,D,T;if(l.enter(E),E.name.value!==w.name.value)if((N=E.selectionSet)!=null&&N.selections.length){const O=u(E);return S.push({name:E.name.value,alias:((D=E.alias)==null?void 0:D.value)||E.name.value,fields:O.fields}),!1}else S.push({name:E.name.value,alias:((T=E.alias)==null?void 0:T.value)||E.name.value})},leave:E=>{l.leave(E)}}})),S!=null&&S.length?{name:w.name.value,alias:((k=w.alias)==null?void 0:k.value)||w.name.value,fields:S}:{name:w.name.value,alias:((I=w.alias)==null?void 0:I.value)||w.name.value}},h=u(i),M=(w=>{if(!w)return[];const k=((E,N)=>E.reduce((D,T)=>({...D,[T[N]]:[...D[T[N]]||[],T]}),{}))(w,"alias"),I=[];return Object.entries(k).forEach(([E,N])=>{const D=[];N.forEach(ee=>{var B;(B=ee.fields)==null||B.forEach(te=>D.push(te))});const T=N[0].name,O=N[0].alias;D!=null&&D.length?I.push({name:T,alias:O,fields:D}):I.push({name:T,alias:O})}),I})(h.fields);M!=null&&M.length?r.push({name:h.name,alias:h.alias,fields:M,path:p}):r.push({name:h.name,alias:h.alias,path:p})},g={InlineFragment:{enter:i=>{l.enter(i)},leave:i=>{l.leave(i)}},Field:{enter:(i,f,d,_,v)=>{l.enter(i);const p=l.getType();if(p){const u=L(p);if(q(u)&&u.name==="Node"||z(u)&&u.getTypes().every(P=>P.getInterfaces().some(M=>M.name==="Node"))||Q(u)&&u.getInterfaces().some(h=>h.name==="Node"))return y(i)}}}},c={InlineFragment:{enter:i=>{l.enter(i)},leave:i=>{l.leave(i)}},Field:{enter:(i,f,d,_,v)=>{l.enter(i);const p=l.getType();if(p){const u=L(p);if(q(u)&&u.name==="Node"||z(u)&&u.getTypes().every(P=>P.getInterfaces().some(M=>M.name==="Node"))||Q(u)&&u.getInterfaces().some(h=>h.name==="Node"))return o(i,f,d,_,v),!1}}}},b=V(n,U(l,g));return V(b,U(l,c)),{formifiedQuery:b,blueprints:r}},_e=H(`
 query Sample {
  ...on Document {
    _internalValues: _values
    _internalSys: _sys {
      breadcrumbs
      basename
      filename
      path
      extension
      relativePath
      title
      template
      collection {
        name
        slug
        label
        path
        format
        matches
        templates
        fields
        __typename
      }
      __typename
    }
  }
 }`),ve=_e.definitions[0].selectionSet.selections,Ee=K({tsTypes:{},schema:{context:{},services:{},events:{}},id:"(machine)",initial:"initializing",states:{initializing:{invoke:{src:"initializer",onDone:[{actions:["storeFormAndData","notifyParent"],target:"ready"}],onError:[{actions:"handleError",target:"error"}]}},ready:{},error:{}}},{actions:{notifyParent:ne(e=>({type:"DOCUMENT_READY",value:e.id})),handleError:(e,t)=>{console.error(t.data)},storeFormAndData:A((e,t)=>({...e,form:t.data.form,data:t.data.data}))},services:{initializer:async e=>{const t=e.cms.api.tina;let r;e.data?r=e.data:r=(await t.request(`query GetNode($id: String!) {
        node(id: $id) {
          ...on Document {
            _internalValues: _values
            _internalSys: _sys {
              breadcrumbs
              basename
              filename
              path
              extension
              relativePath
              title
              template
              collection {
                name
                slug
                label
                path
                format
                matches
                templates
                fields
                __typename
              }
              __typename
            }
          }
        }
      }`,{variables:{id:e.id}})).node;const s=e.cms.api.tina.schema;if(!s)throw new Error("Schema must be provided");const a=s.getCollection(r._internalSys.collection.name);let n;if(a.templates?n=a.templates.find(c=>{if(typeof c=="string")throw new Error("Global templates not supported");return c.name===r._internalSys.template}):n=a,!n)throw new Error(`Unable to find template for node ${r._internalSys.path}`);const l=re({collection:a,basename:r._internalSys.filename,schema:s,template:n}),y=async c=>{try{const b=`#graphql
              mutation UpdateDocument($collection: String!, $relativePath: String!, $params: DocumentUpdateMutation!) {
                updateDocument(collection: $collection, relativePath: $relativePath, params: $params) {
                  __typename
                }
              }
            `;await e.cms.api.tina.request(b,{variables:{collection:r._internalSys.collection.name,relativePath:r._internalSys.relativePath,params:s.transformPayload(r._internalSys.collection.name,c)}}),e.cms.alerts.success("Document saved!")}catch(b){e.cms.alerts.error("There was a problem saving your document"),console.error(b)}},m={id:e.id,label:r._internalSys.title||r._internalSys.collection.label,initialValues:r._internalValues,fields:l.fields,onSubmit:y},o=e.formifyCallback;return{form:Se(m,e.cms,c=>o?o(c,e.cms):c.createForm(c.formConfig),!0),data:r}}}}),we=(e,t)=>({createForm:a=>new $(a),createGlobalForm:(a,n)=>new $({...a,global:{global:!0,...n}})}),Se=(e,t,r,s=!1,a)=>{const{createForm:n,createGlobalForm:l}=we(),y="SKIPPED";let m,o;const g=()=>{o=y};if(!o){if(r?m=r({formConfig:e,createForm:n,createGlobalForm:l,skip:g},t):m=n(e),!(m instanceof $)){if(o===y)return;throw new Error("formify must return a form or skip()")}return m}},x={id:null,data:null,variables:{},documentMap:{},documents:[],documentNode:{kind:"Document",definitions:[]},iframe:null},Fe=K({tsTypes:{},schema:{context:{},services:{},events:{}},id:"(machine)",type:"parallel",states:{pipeline:{initial:"idle",states:{idle:{entry:"clear",on:{ADD_QUERY:{target:"initializing"},SUBDOCUMENTS:{target:"pending"},IFRAME_MOUNTED:{actions:"setIframe"}}},initializing:{invoke:{src:"initializer",onDone:[{actions:"storeInitialValues",target:"pending"}],onError:[{actions:"handleError",target:"error"}]}},waiting:{on:{DOCUMENT_READY:{target:"pending"}}},pending:{invoke:{src:"setter",onDone:[{target:"ready"}],onError:[{actions:"handleMissingDocument",target:"waiting"}]}},ready:{entry:"resolveData",invoke:{src:"onChangeCallback"},on:{NAVIGATE:{target:"idle"},REMOVE_QUERY:{target:"idle"},FIELD_CHANGE:{target:"pending"}}},error:{}}}}},{actions:{handleError:(e,t)=>console.error(t.data),handleMissingDocument:A((e,t)=>{if(t.data instanceof Y){if(e.documentMap[t.data.id]||!t.data.id)return e;const r=e.documents.find(a=>a._internalSys.path===t.data.id),s={ref:le(Ee.withContext({id:t.data.id,cms:e.cms,formifyCallback:e.formifyCallback,form:null,data:r||null}))};return{...e,documentMap:{...e.documentMap,[t.data.id]:{...s,skipFormRegister:t.data.skipFormRegister}}}}else return console.error(t.data),e}),clear:A(e=>(e.cms.forms.all().forEach(t=>{e.cms.forms.remove(t.id)}),{...x,formifyCallback:e.formifyCallback,cms:e.cms,iframe:e.iframe})),storeInitialValues:A((e,t)=>({...e,...t.data})),setIframe:A((e,t)=>({...e,iframe:t.value})),resolveData:A((e,t)=>{var r,s;return e.iframe&&((s=(r=e.iframe)==null?void 0:r.contentWindow)==null||s.postMessage({type:"updateData",id:e.id,data:t.data.data})),{...e,data:t.data.data}})},services:{setter:async e=>{const t=e.cms.api.tina.schema,r=e.cms.api.tina.gqlSchema,s=[],a=await ie({schema:r,source:W(e.documentNode),rootValue:e.data,variableValues:e.variables,fieldResolver:(m,o,g,c)=>{var d,_,v;const b=c.fieldName,i=[];c.fieldNodes.forEach(p=>{p.alias&&i.push(p.alias.value)});let f=m[b];if(f||i.forEach(p=>{const u=m[p];u&&(f=u)}),b==="_sys")return m._internalSys;if(b==="_values")return m._internalValues;if(De(c.returnType)){const p=m[b];let u=!1;if(!p)return null;let h="";if(typeof p=="string"?(u=!0,h=p):h=p._internalSys.path,e.documentMap[h]){const M=(d=e.documentMap[h].ref.getSnapshot())==null?void 0:d.context;if(!M)throw new Error(`Document not set up properly for id: ${h}`);const{data:w,form:S}=M,k=S==null?void 0:S.values;if(!w||!S||!k)throw new Error(`Document not set up properly for id: ${h}`);const I=w._internalSys.collection.name,E=M.data,N=G({fields:S.fields,values:k,tinaSchema:t}),D=t.getTemplateForData({data:S.values,collection:t.getCollection(I)});return{...E,...N,_sys:w._internalSys,id:h,__typename:j.dataTypeName(D.namespace)}}else return(v=(_=c.path)==null?void 0:_.prev)!=null&&v.prev&&(u=!0),s.push({id:h,skipFormRegister:u}),null}return f}});if(s.length>0){const m=s[0];throw new Y("Unable to resolve form for initial document",m.id,m.skipFormRegister)}const n="__meta__";function*l(m){const o=new Set;function*g(c,b=[]){if(!o.has(c)){o.add(c);for(let i of Object.keys(c)){const f=b.concat(i);yield[i,c[i],f,c],c[i]!==null&&typeof c[i]=="object"&&["_internalSys","_internalValues","_sys",n].includes(i)&&(yield*g(c[i],f))}}}yield*g(m)}const y=[];for(let[m,o,g,c]of l(a.data))if(o!=null&&o._internalSys){y.push(g);const b={},f=y.filter(d=>g.join(".").startsWith(d.join("."))).reduce(function(d,_){return d.length<_.length?d:_});Object.keys(o).map(d=>{if(["__typename","_internalSys","_internalValues","_sys"].includes(d))return!1;b[d]=[...g.slice(f.length+1),d].join(".")}),o[n]={id:o==null?void 0:o._internalSys.path,name:g.slice(f.length).join("."),fields:b}}else if(typeof o=="object"&&!Array.isArray(o)&&o!==null&&m!==n){const b=y.filter(i=>g.join(".").startsWith(i.join(".")));if(b.length){const i=b.reduce(function(v,p){return v.length<p.length?v:p}),d=se(a.data,i.join("."))._internalSys.path,_={};Object.keys(o).map(v=>{if(["__typename","_internalSys","_internalValues","_sys"].includes(v))return!1;_[v]=[...g.slice(i.length),v].join(".")}),o[n]={id:d,name:g.slice(i.length).join("."),fields:_}}}return{data:a.data}},initializer:async(e,t)=>{const s=await e.cms.api.tina.getSchema(),a=H(t.value.query),{formifiedQuery:n}=await be({schema:s,optimizedDocumentNode:a}),l=await e.cms.api.tina.request(W(n),{variables:t.value.variables}),y=[];return JSON.stringify(l,(m,o)=>(o!=null&&o._internalValues&&y.push(o),o)),{data:l,documents:y,variables:t.value.variables,documentNode:n,id:t.value.id}},onChangeCallback:e=>(t,r)=>{const s=e.cms.api.tina.schema;Object.values(e.documentMap).forEach(a=>{var m,o,g;if(!e.registerSubForms&&a.skipFormRegister)return;const n=(m=a.ref.getSnapshot())==null?void 0:m.context,l=(o=n==null?void 0:n.data)==null?void 0:o._internalSys.collection.name,y=s.getCollection(l||"");n!=null&&n.form&&((g=y.ui)!=null&&g.global?e.cms.plugins.add(new oe(n.form)):e.cms.forms.add(n.form))}),e.cms&&(e.cms.events.subscribe("forms:fields:onChange",a=>{Object.keys(e.documentMap).includes(a.formId)&&t({type:"FIELD_CHANGE"})}),e.cms.events.subscribe("forms:reset",a=>{Object.keys(e.documentMap).includes(a.formId)&&t({type:"FIELD_CHANGE"})}))}}});class Y extends Error{constructor(t,r,s){super(t),this.name="QueryError",this.id=r,this.skipFormRegister=s}}const De=e=>{const t=L(e);if(q(t)&&t.name==="Node"||z(t)&&t.getTypes().every(s=>s.getInterfaces().some(a=>a.name==="Node"))||Q(t)&&t.getInterfaces().some(r=>r.name==="Node"))return!0},G=({fields:e,values:t,tinaSchema:r})=>{const s={};return e.forEach(a=>{const n=t[a.name];typeof n>"u"||n!==null&&(s[a.name]=Me({field:a,value:n,tinaSchema:r}))}),s},Me=({field:e,value:t,tinaSchema:r})=>{switch(e.type){case"object":{if(e.templates&&e.list&&Array.isArray(t))return t.map(a=>{const n=e.templates[a._template];if(typeof n=="string")throw new Error("Global templates not supported");return{__typename:j.dataTypeName(n.namespace),...G({fields:n.fields,values:a,tinaSchema:r})}});const s=e.fields;if(typeof s=="string")throw new Error("Global templates not supported");if(!s)throw new Error(`Expected to find sub-fields on field ${e.name}`);if(e.list){if(Array.isArray(t))return t.map(a=>({__typename:j.dataTypeName(e.namespace),...G({fields:s,values:a,tinaSchema:r})}))}else return{__typename:j.dataTypeName(e.namespace),...G({fields:s,values:t,tinaSchema:r})}}default:return t}},Ne=e=>{const[t,r]=R.useState(null);return R.useEffect(()=>{e.iframeRef.current&&(window.addEventListener("message",s=>{s.data.type==="open"&&r(s.data)}),window.addEventListener("message",s=>{var a,n,l,y;((a=s==null?void 0:s.data)==null?void 0:a.type)==="isEditMode"&&((y=(l=(n=e.iframeRef)==null?void 0:n.current)==null?void 0:l.contentWindow)==null||y.postMessage({type:"tina:editMode"}))}))},[e.iframeRef.current]),J("div",{className:"tina-tailwind",children:[t&&F(Te,{payload:t,iframeRef:e.iframeRef,formifyCallback:e.formifyCallback},t.id),F("iframe",{id:"tina-iframe",ref:e.iframeRef,className:"h-screen w-full bg-white",src:e.url})]})},Te=e=>{const t=X(),r=R.useMemo(()=>Fe.withContext({...x,cms:t,formifyCallback:e.formifyCallback}),[]),[s,a]=ce(r);return R.useEffect(()=>{s.matches("pipeline.ready")?t.events.dispatch({type:"forms:register",value:"complete"}):s.matches("pipeline.initializing")&&t.events.dispatch({type:"forms:register",value:"start"})},[JSON.stringify(s.value)]),R.useEffect(()=>{e.iframeRef.current&&(a({type:"IFRAME_MOUNTED",value:e.iframeRef.current}),e.payload.type==="open"&&a({type:"ADD_QUERY",value:e.payload}),window.addEventListener("message",n=>{n.data.type==="close"&&a({type:"REMOVE_QUERY"})}))},[e.iframeRef.current]),null},Ie=new Object({NODE_ENV:"production"}).HEAD||new Object({NODE_ENV:"production"}).VERCEL_GIT_COMMIT_REF||"main",C=me({branch:Ie,clientId:"de22fc98-b2e9-4a98-88ab-db440eef3dc1",token:"15c0d8bb8ab2d942415a88d7d723902e66c4fd08",build:{outputFolder:"admin",publicFolder:"public"},media:{tina:{mediaRoot:"",publicFolder:"public"}},schema:{collections:[{label:"Events",name:"events",path:"events",fields:[{type:"rich-text",name:"body",label:"Body of Document",description:"This is the markdown body",isBody:!0}]},{label:"Theatres",name:"theatres",path:"theatres",fields:[{type:"rich-text",name:"body",label:"Body of Document",description:"This is the markdown body",isBody:!0}]},{label:"Archive",name:"archive",path:"archive",fields:[{type:"rich-text",name:"body",label:"Body of Document",description:"This is the markdown body",isBody:!0}]}]}}),Re=R.lazy(()=>de(()=>import("./index.fa2731dc.js"),["assets/index.fa2731dc.js","assets/vendor.49c286d8.js"])),ke=e=>{const[t,r]=R.useState(!1);return F(Z.Component,{rawMode:t,setRawMode:r,...e,rawEditor:F(he.exports.Suspense,{fallback:F("div",{children:"Loading raw editor..."}),children:F(Re,{...e,setRawMode:r,rawMode:t})})})},Ce=({outputFolder:e})=>{const t=X();return t.flags.set("tina-preview",e),t.fields.add({...Z,Component:ke}),null},Ae=()=>{const e={...C==null?void 0:C.schema,config:C};return J(fe,{...C,schema:e,client:{apiUrl:"https://content.tinajs.io/content/de22fc98-b2e9-4a98-88ab-db440eef3dc1/github/main"},children:[F(Ce,{outputFolder:C.build.outputFolder}),F(pe,{preview:Ne,config:C})]})},Pe=()=>{const{setEdit:e}=ye();return e(!0),F("div",{children:"Going into edit mode"})};function Oe(){return F(ue,{editMode:F(Ae,{}),children:F(Pe,{})})}ge.render(F(R.StrictMode,{children:F(Oe,{})}),document.getElementById("root"));
//# sourceMappingURL=index.c8453136.js.map
